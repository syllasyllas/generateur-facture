<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur de Facture</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f7f6;
        }
        #main-content {
            display: none; /* Contenu principal cach√© par d√©faut */
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.75);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-box {
            background: white;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }
        .modal-box h2 {
            margin-top: 0;
            color: #333;
        }
        .pin-input {
            padding: 12px;
            font-size: 20px;
            text-align: center;
            width: 150px;
            border: 1px solid #ccc;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        .error-message {
            color: red;
            display: none;
            margin-top: 10px;
        }
        .conteneur {
            width: 100%;
            max-width: 800px;
        }
        .formulaire, .apercu-recu, .base-de-donnees {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }
        h1, h2 {
            color: #1a2533;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
            margin-top: 0;
        }
        .champ {
            margin-bottom: 18px;
        }
        .champ-groupe {
            display: flex;
            gap: 20px;
        }
        .champ-groupe .champ {
            width: 100%;
        }
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #333;
        }
        input[type="text"], input[type="number"], textarea, select {
            width: calc(100% - 22px);
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            transition: border-color 0.3s, background-color 0.3s;
        }
        select {
             width: 100%;
        }
        input:focus, textarea:focus, select:focus {
            border-color: #007bff;
            outline: none;
        }
        input:disabled {
            background-color: #e9ecef;
            cursor: not-allowed;
        }
        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .checkbox-container label {
            margin-bottom: 0;
            font-weight: normal;
        }
        .bouton-groupe {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        button {
            display: inline-block;
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s, opacity 0.3s;
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .bouton-principal {
            background-color: #007bff;
            color: white;
        }
        .bouton-principal:hover:not(:disabled) {
            background-color: #0056b3;
        }
        .bouton-secondaire {
            background-color: #6c757d;
            color: white;
        }
        .bouton-secondaire:hover:not(:disabled) {
            background-color: #5a6268;
        }
        .bouton-tertiaire {
            background-color: #17a2b8;
            color: white;
        }
        .bouton-tertiaire:hover:not(:disabled) {
            background-color: #138496;
        }
        .bouton-danger {
            background-color: #dc3545;
        }
        .bouton-danger:hover:not(:disabled) {
            background-color: #c82333;
        }
        
        #recu {
            border: 1px solid #e0e0e0;
            padding: 25px;
            border-radius: 8px;
            position: relative; /* N√©cessaire pour le filigrane */
            overflow: hidden; /* Emp√™che le filigrane de d√©border */
        }
        #recu::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 80%;
            height: 80%;
            transform: translate(-50%, -50%);
            background-image: url('https://i.postimg.cc/ncnzhbWX/Design-sans-titre-3.png');
            background-repeat: no-repeat;
            background-position: center;
            background-size: contain;
            opacity: 0.08;
            pointer-events: none;
            z-index: 1;
        }
        .invoice-content {
            position: relative;
            z-index: 2; /* S'assure que le contenu est au-dessus du filigrane */
        }
        .header-recu {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 20px;
            margin-bottom: 20px;
        }
        .logo {
            max-width: 220px;
        }
        .infos-entreprise {
            text-align: right;
            font-size: 14px;
            color: #555;
        }
        .corps-recu {
            margin-top: 20px;
        }
        .titre-facture {
            text-align: center;
            font-size: 2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
        }
        .infos-transaction {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
        }
        .details-expedition, .details-contenu {
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(249, 250, 251, 0.8); /* Fond l√©g√®rement transparent */
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }
        .parties-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
        }
        .partie {
            width: 48%;
        }
        .partie strong, .details-expedition strong, .details-contenu strong {
            color: #007bff;
        }
        .table-contenu, #dbTable {
            width: 100%;
            margin-top: 10px;
            border-collapse: collapse;
        }
        .table-contenu th, .table-contenu td, #dbTable th, #dbTable td {
            border: 1px solid #e5e7eb;
            padding: 12px;
            text-align: left;
            font-size: 14px;
        }
        .table-contenu th, #dbTable th {
            background-color: rgba(241, 245, 249, 0.8);
            font-weight: 600;
        }
        .table-contenu td:nth-child(2), .table-contenu td:nth-child(3) {
            text-align: right;
        }
        .resume-financier {
            margin-top: 20px;
            padding-left: 50%;
        }
        .resume-financier table {
            width: 100%;
            border-collapse: collapse;
        }
        .resume-financier td {
            padding: 8px;
            border-bottom: 1px solid #eee;
        }
        .resume-financier .grand-total td {
            font-weight: bold;
            font-size: 1.2em;
            color: #D32F2F; /* Grand total en rouge */
            border-top: 2px solid #333;
        }
        .pied-recu {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid #ccc;
            font-size: 12px;
            color: #666;
        }
        .note-importante {
            font-weight: bold;
            color: #D32F2F;
            background-color: rgba(255, 235, 238, 0.8);
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            margin-bottom: 20px;
        }
        .signatures {
            margin-top: 100px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }
        .zone-signature {
            border-top: 1px solid #333;
            width: 45%;
            text-align: center;
            padding-top: 8px;
            font-size: 13px;
            height: 150px;
        }
        .signature-image {
            display: block;
            max-height: 200px;
            margin: -160px auto -15px auto;
        }

        /* Styles pour Mobile */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            #main-content {
                flex-direction: column;
            }
            .conteneur, .formulaire, .apercu-recu, .base-de-donnees {
                padding: 15px;
            }
            .champ-groupe, .parties-container, .signatures, .bouton-groupe {
                flex-direction: column;
                gap: 15px;
            }
            .partie, .zone-signature {
                width: 100%;
            }
            .resume-financier {
                padding-left: 0;
            }
            .signatures {
                gap: 50px;
            }
            #dbTable th, #dbTable td {
                font-size: 12px;
                padding: 8px;
            }
        }

        /* Styles pour l'impression */
        @media print {
            @page {
                size: A4;
                margin: 5mm; /* Marge r√©duite */
            }
            html, body {
                width: 210mm;
                height: 297mm;
                overflow: hidden; /* Pas de scroll */
                font-size: 9.5pt; /* Police lisible */
            }
            body { 
                background-color: white !important; 
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            #main-content { display: block !important; }
            .formulaire, .boutons-actions, h2, .base-de-donnees, #login-overlay, #delete-overlay { display: none !important; }
            .apercu-recu { 
                box-shadow: none !important; 
                width: 100% !important; 
                padding: 0 !important; 
                margin: 0 !important;
                border: none !important;
            }
            #recu { 
                border: none !important;
                padding: 0 !important;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
                min-height: calc(297mm - 10mm);
                page-break-inside: avoid !important;
            }
            #recu::before {
                opacity: 0.06 !important; /* Filigrane plus discret √† l'impression */
            }
            .logo { max-width: 150px !important; }
            .titre-facture { font-size: 1.5em !important; margin-bottom: 8px !important; }
            .details-expedition, .details-contenu { padding: 8px !important; margin-top: 8px !important; }
            .table-contenu th, .table-contenu td { padding: 5px !important; }
            .resume-financier { padding-left: 0 !important; margin-top: 10px !important; }
            .pied-recu { margin-top: 25px !important; padding-top: 10px !important; }
            .signatures { margin-top: 60px !important; page-break-inside: avoid !important; }
            .zone-signature { height: 80px !important; }
            .signature-image { max-height: 100px !important; margin: -80px auto -15px auto !important; }
            .note-importante { background-color: #f0f0f0 !important; padding: 8px !important; }
        }
    </style>
</head>
<body onload="chargerBaseDeDonnees()">

    <div id="login-overlay" class="overlay">
        <div class="modal-box">
            <h2>Acc√®s S√©curis√©</h2>
            <p>Veuillez entrer le code PIN pour continuer.</p>
            <input type="password" id="pin-input" class="pin-input" maxlength="4" autofocus>
            <button type="button" onclick="checkPin()" class="bouton-principal">Entrer</button>
            <p id="error-message-login" class="error-message">Code PIN incorrect.</p>
        </div>
    </div>

    <div id="delete-overlay" class="overlay" style="display: none;">
        <div class="modal-box">
            <h2>Confirmation Requise</h2>
            <p>Entrez le code PIN pour vider la base de donn√©es.</p>
            <input type="password" id="delete-pin-input" class="pin-input" maxlength="4">
            <div class="bouton-groupe">
                <button type="button" onclick="confirmerSuppression()" class="bouton-danger">Confirmer</button>
                <button type="button" onclick="document.getElementById('delete-overlay').style.display = 'none'" class="bouton-secondaire">Annuler</button>
            </div>
            <p id="error-message-delete" class="error-message">Code PIN incorrect.</p>
        </div>
    </div>

    <div id="main-content">
        <div class="conteneur formulaire">
            <form id="invoiceForm">
                <h1>üìù G√©n√©rateur de Facture</h1>
                
                <div class="champ"><label for="clientNom">Nom & Pr√©nom du Destinataire</label><input type="text" id="clientNom" placeholder="Ex: Jean Dupont"></div>
                <div class="champ"><label for="clientContact">Contact du Destinataire</label><input type="text" id="clientContact" placeholder="Ex: 0102030405"></div>
                <div class="champ"><label for="clientVille">Ville de R√©sidence du Destinataire</label><input type="text" id="clientVille" placeholder="Ex: Abidjan"></div>
                <hr style="border: 1px solid #f0f0f0; margin: 25px 0;">
                
                <div class="champ"><label for="expediteur">Nom de l'Exp√©diteur</label><input type="text" id="expediteur" placeholder="Nom de la personne qui d√©pose le colis"></div>
                <div class="champ"><label for="expediteurContact">Contact de l'Exp√©diteur</label><input type="text" id="expediteurContact" placeholder="Ex: 0708091011"></div>
                <div class="champ"><label for="expediteurPiece">N¬∞ Pi√®ce d'Identit√© (Exp√©diteur)</label><input type="text" id="expediteurPiece" placeholder="Ex: C00123456789"></div>
                <hr style="border: 1px solid #f0f0f0; margin: 25px 0;">

                <div class="champ"><label for="description">Description</label><textarea id="description" rows="2" placeholder="Ex: V√™tements, documents..."></textarea></div>
                <div class="champ-groupe">
                    <div class="champ"><label for="unitType">Unit√©</label><select id="unitType"><option value="Poids/KG">Poids/KG</option><option value="CBM">CBM</option></select></div>
                    <div class="champ"><label for="unitValue">Valeur de l'unit√©</label><input type="number" id="unitValue" placeholder="Ex: 5"></div>
                </div>
                <div class="champ"><label for="montant">Montant (FCFA)</label><input type="number" id="montant" placeholder="Ex: 25000"></div>
                <div class="champ"><label for="valeurColis">Valeur du Colis</label><input type="number" id="valeurColis" placeholder="Ex: 100000"></div>
                <div class="champ"><label for="prixDeclare">Prix D√©clar√© Pris en Compte</label><input type="number" id="prixDeclare" placeholder="Ex: 100000"></div>
                <div class="champ">
                    <div class="checkbox-container"><input type="checkbox" id="hasReduction" onchange="toggleReductionInput()"><label for="hasReduction">Appliquer une r√©duction</label></div>
                    <input type="number" id="reduction" placeholder="Saisir le montant de la r√©duction" disabled>
                </div>
                <div class="champ">
                     <div class="checkbox-container"><input type="checkbox" id="hasTracking" onchange="toggleTrackingInput()"><label for="hasTracking">Le colis a un num√©ro de tracking</label></div>
                    <input type="text" id="tracking" placeholder="Saisir le num√©ro de tracking" disabled>
                </div>

                <div class="bouton-groupe">
                    <button type="button" onclick="genererFacture()" class="bouton-principal">G√©n√©rer & Sauvegarder</button>
                    <button type="button" onclick="reinitialiserFacture()" class="bouton-secondaire">R√©initialiser</button>
                </div>
            </form>
        </div>

        <div class="conteneur apercu-recu">
            <h2>Aper√ßu de la Facture</h2>
            <div id="recu">
                <div class="invoice-content">
                    <div> <!-- Conteneur pour le haut de la facture -->
                        <div class="header-recu">
                            <div><img src="https://i.postimg.cc/ncnzhbWX/Design-sans-titre-3.png" alt="Logo MONCOLIS.CI" class="logo"></div>
                            <div class="infos-entreprise">
                                <strong>MONCOLIS.CI</strong><br>
                                <span style="font-size: 12px; color: #777;">Une repr√©sentation de EKF-CORPORATION</span><br><br>
                                Cocody Riviera Palmeraie, Rue Ministre, Abidjan<br>
                                T√©l√©phone : +225 07 49 75 55 19<br>
                                N¬∞ Registre : RVN: CI-ABJ-03-2021-B12-01877
                            </div>
                        </div>

                        <div class="corps-recu">
                            <div class="titre-facture">FACTURE</div>
                            <div class="infos-transaction">
                                <div><strong>Date :</strong> <span id="facture-date">-</span><br><strong>N¬∞ Facture :</strong> <span id="facture-num">-</span></div>
                            </div>

                            <div class="details-expedition">
                                <div class="parties-container">
                                    <div class="partie">
                                        <strong>Destinataire :</strong><br>
                                        Nom : <span id="facture-clientNom">-</span><br>
                                        Contact : <span id="facture-clientContact">-</span><br>
                                        Ville : <span id="facture-clientVille">-</span>
                                    </div>
                                    <div class="partie">
                                        <strong>Exp√©diteur :</strong><br>
                                        Nom : <span id="facture-expediteur">-</span><br>
                                        Contact : <span id="facture-expediteurContact">-</span><br>
                                        N¬∞ Pi√®ce d'Identit√© : <span id="facture-expediteurPiece">-</span>
                                    </div>
                                </div>
                                <hr style="border: 0; border-top: 1px solid #e5e7eb; margin: 15px 0;">
                                <div><strong>Num√©ro de Tracking :</strong> <span id="facture-tracking">-</span></div>
                            </div>

                            <div class="details-contenu">
                                <strong>D√©tails du Contenu du Colis :</strong>
                                <table class="table-contenu">
                                    <thead>
                                        <tr>
                                            <th>Description</th>
                                            <th id="header-unit">Poids/KG</th>
                                            <th>Montant</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td id="facture-description">-</td>
                                            <td id="facture-unitValue">-</td>
                                            <td id="facture-montant">-</td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div class="resume-financier">
                                    <table>
                                        <tbody>
                                            <tr><td>Valeur du Colis :</td><td style="text-align:right;"><span id="facture-valeurColis">0</span> FCFA</td></tr>
                                            <tr><td>Prix D√©clar√© Pris en Compte :</td><td style="text-align:right;"><span id="facture-prixDeclare">0</span> FCFA</td></tr>
                                            <tr id="ligne-reduction" style="display:none;"><td>R√©duction :</td><td style="text-align:right;">- <span id="facture-reduction">0</span> FCFA</td></tr>
                                            <tr class="grand-total"><td>GRAND TOTAL :</td><td style="text-align:right;"><span id="facture-grandTotal">0</span> FCFA</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="pied-recu">
                        <p class="note-importante">Important : Les charges de la douane sont √† la responsabilit√© exclusive du client.</p>
                        <div class="signatures">
                            <div class="zone-signature">Signature de l'Exp√©diteur</div>
                            <div class="zone-signature">
                                <img src="https://i.postimg.cc/15WW3FHb/Untitled-design.png" alt="Signature de l'agence" class="signature-image">
                                Signature de l'Agence
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="boutons-actions" style="margin-top:20px;">
                <div class="bouton-groupe">
                    <button id="printBtn" class="bouton-principal" onclick="window.print()" disabled>üñ®Ô∏è Imprimer</button>
                    <button id="emailBtn" class="bouton-tertiaire" onclick="envoyerEmail()" disabled>‚úâÔ∏è Envoyer par E-mail</button>
                </div>
            </div>
        </div>

        <div class="conteneur base-de-donnees">
            <h2>üìä Base de Donn√©es des Factures</h2>
            <table id="dbTable">
                <thead>
                    <tr>
                        <th>N¬∞ Facture</th>
                        <th>Date</th>
                        <th>Destinataire</th>
                        <th>T√©l√©phone</th>
                        <th>Grand Total</th>
                    </tr>
                </thead>
                <tbody id="dbBody"></tbody>
            </table>
            <button onclick="demanderPinPourSuppression()" class="bouton-danger" style="margin-top: 20px; width: 100%;">Vider la Base de Donn√©es</button>
        </div>
    </div>

    <script>
        let numeroFactureActuel = '';
        let inactivityTimer;

        function logout() {
            document.getElementById('login-overlay').style.display = 'flex';
            document.getElementById('main-content').style.display = 'none';
            document.getElementById('pin-input').value = '';
            document.getElementById('pin-input').focus();
        }

        function resetInactivityTimer() {
            clearTimeout(inactivityTimer);
            inactivityTimer = setTimeout(logout, 3600 * 1000); // 1 heure
        }

        function setupInactivityListeners() {
            const activityEvents = ['mousemove', 'mousedown', 'keypress', 'scroll', 'touchstart'];
            activityEvents.forEach(event => {
                window.addEventListener(event, resetInactivityTimer, true);
            });
        }

        function checkPin() {
            const correctPin = "5008";
            const enteredPin = document.getElementById('pin-input').value;
            const errorMessage = document.getElementById('error-message-login');

            if (enteredPin === correctPin) {
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('main-content').style.display = 'flex';
                resetInactivityTimer();
                setupInactivityListeners();
            } else {
                errorMessage.style.display = 'block';
                document.getElementById('pin-input').value = '';
            }
        }
        document.getElementById('pin-input').addEventListener('keyup', function(event) {
            if (event.key === "Enter") {
                checkPin();
            }
        });

        function toggleTrackingInput() {
            const trackingInput = document.getElementById('tracking');
            const hasTrackingCheckbox = document.getElementById('hasTracking');
            trackingInput.disabled = !hasTrackingCheckbox.checked;
            if (!hasTrackingCheckbox.checked) {
                trackingInput.value = '';
            }
        }
        
        function toggleReductionInput() {
            const reductionInput = document.getElementById('reduction');
            const hasReductionCheckbox = document.getElementById('hasReduction');
            reductionInput.disabled = !hasReductionCheckbox.checked;
            if (!hasReductionCheckbox.checked) {
                reductionInput.value = '';
            }
        }

        function reinitialiserFacture() {
            document.getElementById('invoiceForm').reset();
            
            const fieldsToReset = [
                'facture-date', 'facture-num', 'facture-clientNom', 'facture-clientContact', 
                'facture-clientVille', 'facture-expediteur', 'facture-expediteurContact', 
                'facture-expediteurPiece', 'facture-tracking', 'facture-description', 'facture-unitValue'
            ];
            fieldsToReset.forEach(id => {
                document.getElementById(id).innerText = '-';
            });
            
            document.getElementById('facture-montant').innerText = '-';
            document.getElementById('facture-valeurColis').innerText = '0';
            document.getElementById('facture-prixDeclare').innerText = '0';
            document.getElementById('facture-grandTotal').innerText = '0';
            document.getElementById('ligne-reduction').style.display = 'none';

            document.getElementById('printBtn').disabled = true;
            document.getElementById('emailBtn').disabled = true;
            numeroFactureActuel = '';

            toggleTrackingInput();
            toggleReductionInput();
        }

        function chargerBaseDeDonnees() {
            const factures = JSON.parse(localStorage.getItem('facturesDB')) || [];
            const dbBody = document.getElementById('dbBody');
            dbBody.innerHTML = '';
            factures.forEach(facture => {
                ajouterFactureAuTableau(facture);
            });
        }

        function ajouterFactureAuTableau(facture) {
            const dbBody = document.getElementById('dbBody');
            const newRow = dbBody.insertRow(0);

            newRow.insertCell(0).innerText = facture.numero;
            newRow.insertCell(1).innerText = facture.date;
            newRow.insertCell(2).innerText = facture.destinataire;
            newRow.insertCell(3).innerText = facture.telephone;
            newRow.insertCell(4).innerText = facture.total + " FCFA";
        }
        
        function demanderPinPourSuppression() {
            document.getElementById('delete-overlay').style.display = 'flex';
            document.getElementById('delete-pin-input').focus();
            document.getElementById('error-message-delete').style.display = 'none';
        }

        function confirmerSuppression() {
            const correctPin = "5008";
            const enteredPin = document.getElementById('delete-pin-input').value;
            const errorMessage = document.getElementById('error-message-delete');

            if (enteredPin === correctPin) {
                localStorage.removeItem('facturesDB');
                chargerBaseDeDonnees();
                document.getElementById('delete-overlay').style.display = 'none';
                document.getElementById('delete-pin-input').value = '';
            } else {
                errorMessage.style.display = 'block';
                document.getElementById('delete-pin-input').value = '';
            }
        }

        function envoyerEmail() {
            const recipient = 'syllasylla@icloud.com';
            const subject = `Facture N¬∞ ${numeroFactureActuel}`;
            const body = `Bonjour,\n\nLa facture N¬∞${numeroFactureActuel} a √©t√© g√©n√©r√©e.\n\nPour la visualiser, veuillez l'imprimer en format PDF depuis l'application.\n\nCordialement,\nMONCOLIS.CI`;
            const mailtoLink = `mailto:${recipient}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            window.location.href = mailtoLink;
        }

        function genererFacture() {
            const maintenant = new Date();
            const dateStr = maintenant.toLocaleDateString('fr-FR', { day: '2-digit', month: '2-digit', year: 'numeric' });
            numeroFactureActuel = 'FACT-' + maintenant.getTime(); 

            const clientNom = document.getElementById('clientNom').value;
            const clientContact = document.getElementById('clientContact').value;
            const clientVille = document.getElementById('clientVille').value;
            const expediteur = document.getElementById('expediteur').value;
            const expediteurContact = document.getElementById('expediteurContact').value;
            const expediteurPiece = document.getElementById('expediteurPiece').value;
            const description = document.getElementById('description').value;
            const unitType = document.getElementById('unitType').value;
            const unitValue = document.getElementById('unitValue').value;
            const montant = parseFloat(document.getElementById('montant').value) || 0;
            const valeurColis = document.getElementById('valeurColis').value;
            const prixDeclare = document.getElementById('prixDeclare').value;
            
            let reduction = 0;
            if (document.getElementById('hasReduction').checked) {
                reduction = parseFloat(document.getElementById('reduction').value) || 0;
            }
            
            let trackingValue = "Non applicable";
            if (document.getElementById('hasTracking').checked) {
                trackingValue = document.getElementById('tracking').value || "-";
            }
            
            const grandTotal = montant - reduction;

            document.getElementById('facture-date').innerText = dateStr;
            document.getElementById('facture-num').innerText = numeroFactureActuel;
            document.getElementById('facture-clientNom').innerText = clientNom || "-";
            document.getElementById('facture-clientContact').innerText = clientContact || "-";
            document.getElementById('facture-clientVille').innerText = clientVille || "-";
            document.getElementById('facture-expediteur').innerText = expediteur || "-";
            document.getElementById('facture-expediteurContact').innerText = expediteurContact || "-";
            document.getElementById('facture-expediteurPiece').innerText = expediteurPiece || "-";
            document.getElementById('facture-tracking').innerText = trackingValue;
            
            document.getElementById('header-unit').innerText = unitType;
            document.getElementById('facture-description').innerText = description || "-";
            document.getElementById('facture-unitValue').innerText = unitValue || "-";
            document.getElementById('facture-montant').innerText = montant.toLocaleString('fr-FR') + " FCFA";
            
            document.getElementById('facture-valeurColis').innerText = (valeurColis || "0").toLocaleString('fr-FR');
            document.getElementById('facture-prixDeclare').innerText = (prixDeclare || "0").toLocaleString('fr-FR');
            
            const ligneReduction = document.getElementById('ligne-reduction');
            if (reduction > 0) {
                document.getElementById('facture-reduction').innerText = reduction.toLocaleString('fr-FR');
                ligneReduction.style.display = 'table-row';
            } else {
                ligneReduction.style.display = 'none';
            }
            
            document.getElementById('facture-grandTotal').innerText = grandTotal.toLocaleString('fr-FR');

            const factureData = {
                numero: numeroFactureActuel,
                date: dateStr,
                destinataire: clientNom || "-",
                telephone: clientContact || "-",
                total: grandTotal.toLocaleString('fr-FR')
            };

            const factures = JSON.parse(localStorage.getItem('facturesDB')) || [];
            factures.push(factureData);
            localStorage.setItem('facturesDB', JSON.stringify(factures));
            
            ajouterFactureAuTableau(factureData);

            document.getElementById('printBtn').disabled = false;
            document.getElementById('emailBtn').disabled = false;
        }
    </script>
</body>
</html>
